<!-- views/searchResults.ejs -->
<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8">
  <title>Resultados da Busca</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.4.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body>
  <div class="container mt-4">
    <h1>Resultados da Busca para "<%= q %>"</h1>

    <!-- Card explicativo de como a busca funciona -->
    <div class="card mb-4">
      <div class="card-body">
        <h5 class="card-title">Como funciona a busca</h5>
        <p class="card-text">
          A busca verifica o termo informado nas seguintes tabelas e campos:
        </p>
        <ul class="mb-0">
          <% searchInfo.forEach(si=> { %>
            <li>
              <strong>
                <%= si.name %>:
              </strong>
              <%= si.fields.join(', ') %>
            </li>
          <% }) %>
        </ul>
      </div>
    </div>

    <% if (!q) { %>
      <div class="alert alert-warning">
        Informe um termo para começar a busca.
      </div>
    <% } else {
         // descobre em quais tabelas houve resultados
         const mapping = {
           veiculos: ' Veículos', usos: 'Usos de Veículos' , multas: 'Multas' , motoristas: 'Motoristas' }; const
                found=Object .keys(results) .filter(k=> Array.isArray(results[k]) && results[k].length > 0);
                %>
                <% if (found.length===0) { %>
                  <div class="alert alert-info">
                    Nenhum resultado encontrado para "<%= q %>".
                  </div>
                  <% } else { %>
                    <div class="alert alert-success">
                      Foram encontrados registros em
                      <strong>
                        <%= found.length %>
                      </strong>
                      tabela(s): <strong>
                        <%= found.map(k=> mapping[k]).join(', ') %>
                      </strong>
                    </div>

                    <!-- Listagem por tabela -->
                    <% if (results.veiculos.length) { %>
                      <h2>Veículos</h2>
                      <ul class="list-group mb-3">
                        <% results.veiculos.forEach(v=> { %>
                          <li class="list-group-item">
                            <strong>ID:</strong>
                            <%= v.id %> —
                              <a href="/editar-veiculo/<%= v.id %>">
                                <%= v.nome %> – <%= v.placa %>
                              </a>
                          </li>
                          <% }) %>
                      </ul>
                      <% } %>

                        <% if (results.usos.length) { %>
                          <h2>Usos de Veículos</h2>
                          <ul class="list-group mb-3">
                            <% results.usos.forEach(u=> { %>
                              <li class="list-group-item">
                                <strong>ID:</strong>
                                <%= u.id %> —
                                  <a href="/editar-uso/<%= u.id %>">
                                    <%= u.motorista %> (KM Inicial: <%= u.km_inicial %> – Final: <%= u.km_final %>)
                                  </a>
                              </li>
                              <% }) %>
                          </ul>
                          <% } %>

                            <% if (results.multas.length) { %>
                              <h2>Multas</h2>
                              <ul class="list-group mb-3">
                                <% results.multas.forEach(m=> { %>
                                  <li class="list-group-item">
                                    <strong>ID:</strong>
                                    <%= m.id %> —
                                      <%= m.multa %> (Motorista: <%= m.motorista %>)<br>

                                  </li>
                                  <% }) %>
                              </ul>
                              <% } %>

                                <% if (results.motoristas.length) { %>
                                  <h2>Motoristas</h2>
                                  <ul class="list-group mb-3">
                                    <% results.motoristas.forEach(m=> { %>
                                      <li class="list-group-item">
                                        <strong>ID:</strong>
                                        <%= m.id %> — 
                                          <strong>Nome:</strong>
                                          <%= m.nome %>

                                            <small class="text-muted">Email: <%= m.email %></small>
                                      </li>
                                      <% }) %>
                                  </ul>
                                  <% } %>

                                    <% } %>
                                      <% } %>

                                        <a href="/" class="btn btn-secondary mt-3">Voltar</a>
      </div>

      <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.4.3/dist/js/bootstrap.bundle.min.js"></script>
</body>

</html>